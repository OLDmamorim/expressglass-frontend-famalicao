<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Agendamentos Famalicão - Mobile + Desktop</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <meta name="theme-color" content="#2563eb">
  <style>
    /* ========== VARIÁVEIS ========== */
    :root {
      --primary: #2563eb;
      --primary-dark: #1e40af;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-500: #6b7280;
      --gray-700: #374151;
      --gray-900: #111827;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --radius: 12px;
    }

    /* ========== ESTILOS BASE ========== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background-color: #f6f7fb;
      color: var(--gray-900);
      line-height: 1.6;
      padding: 0;
      margin: 0;
      padding-bottom: 60px; /* Espaço para a bottom nav */
    }

    .page {
      max-width: 100%;
      margin: 0 auto;
      padding: 0;
    }

    /* ========== HEADER MOBILE ========== */
    .page-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 1rem;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: var(--shadow);
    }

    .page-header h1 {
      font-size: 1.3rem;
      font-weight: 700;
      margin: 0;
      text-align: center;
    }

    .subtitle {
      font-size: 0.85rem;
      opacity: 0.9;
      margin-top: 0.2rem;
      text-align: center;
      display: block;
    }

    .header-actions {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 0.8rem;
      flex-wrap: wrap;
    }

    .header-btn {
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.25);
      color: white;
      padding: 0.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
      min-width: auto;
    }

    .connection-status {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.25);
      color: #fff;
      padding: 0.4rem 0.6rem;
      border-radius: 8px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    /* ========== BARRA DE PESQUISA MOBILE ========== */
    .search-bar {
      background: white;
      padding: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border-bottom: 1px solid var(--gray-200);
    }

    .search-bar.hidden {
      display: none;
    }

    #searchInput {
      flex: 1;
      padding: 0.7rem;
      border: 1px solid var(--gray-300);
      border-radius: 8px;
      font-size: 0.9rem;
    }

    .search-clear {
      background: var(--danger);
      color: #fff;
      border: none;
      padding: 0.7rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    /* ========== NAVEGAÇÃO MOBILE ========== */
    .nav-bar {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
      padding: 1rem;
      background: white;
      border-bottom: 1px solid var(--gray-200);
    }

    .nav-group {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
    }

    .nav-button {
      background: white;
      border: 1px solid var(--gray-200);
      border-radius: 8px;
      padding: 0.7rem;
      cursor: pointer;
      font-weight: 500;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
      flex: 1;
      justify-content: center;
    }

    .week-range {
      font-weight: 600;
      color: var(--gray-900);
      text-align: center;
      font-size: 1rem;
      padding: 0.5rem;
    }

    /* ========== VISTA MOBILE PRINCIPAL ========== */
    .mobile-view {
      padding: 1rem;
    }

    .mobile-day-container {
      background: white;
      border-radius: var(--radius);
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: var(--shadow);
    }

    .mobile-day-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .mobile-day-label {
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--gray-900);
    }

    .mobile-day-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .mobile-day-list {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }

    .mobile-appointment {
      background: var(--gray-100);
      border-radius: 8px;
      padding: 1rem;
      border-left: 4px solid var(--primary);
    }

    .mobile-appt-header {
      font-weight: 700;
      margin-bottom: 0.4rem;
      font-size: 1rem;
    }

    .mobile-appt-details {
      color: var(--gray-700);
      font-size: 0.9rem;
      margin-bottom: 0.8rem;
    }

    .mobile-appt-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.8rem;
    }

    .mobile-add-btn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 1rem;
      width: 100%;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    /* ========== SERVIÇOS POR AGENDAR MOBILE ========== */
    .unscheduled-container {
      background: white;
      border-radius: var(--radius);
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: var(--shadow);
    }

    .unscheduled-container h3 {
      margin: 0 0 1rem 0;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .unscheduled-actions {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
      margin-bottom: 1rem;
    }

    .action-btn {
      padding: 0.8rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .action-btn.primary {
      background: var(--primary);
      color: #fff;
    }

    .filter-select {
      padding: 0.8rem;
      border: 1px solid var(--gray-300);
      border-radius: 8px;
      background: #fff;
      font-size: 0.9rem;
    }

    .unscheduled-list {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }

    .appointment.unscheduled {
      background: var(--gray-100);
      border-radius: 8px;
      padding: 1rem;
      border-left: 4px solid var(--primary);
    }

    .appt-header {
      font-weight: 700;
      margin-bottom: 0.4rem;
      font-size: 1rem;
    }

    .appt-sub {
      color: var(--gray-700);
      font-size: 0.9rem;
      margin-bottom: 0.8rem;
    }

    .appt-status {
      display: flex;
      gap: 0.8rem;
      margin-bottom: 0.8rem;
      flex-wrap: wrap;
    }

    .appt-status label {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      font-size: 0.8rem;
    }

    .unscheduled-actions-inner {
      display: flex;
      justify-content: flex-end;
      gap: 0.8rem;
    }

    .icon-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.1rem;
      padding: 0.4rem;
    }

    /* ========== CALENDÁRIO DESKTOP ========== */
    .schedule-container {
      background: #fff;
      border: 1px solid var(--gray-200);
      border-radius: var(--radius);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow);
      overflow-x: auto;
      display: none; /* Oculto por padrão (mobile first) */
    }

    .schedule {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      min-width: 900px;
    }

    .schedule thead th {
      background: var(--gray-100);
      text-align: center;
      font-weight: 600;
      padding: 1rem 0.5rem;
      border-bottom: 2px solid var(--gray-200);
    }

    .schedule th .day {
      font-size: 1.1rem;
      color: var(--gray-800);
      display: block;
    }

    .schedule th .date {
      font-size: 0.9rem;
      color: var(--gray-600);
      display: block;
      margin-top: 0.2rem;
    }

    .schedule tbody th {
      background: var(--gray-100);
      text-align: left;
      padding: 1rem;
      font-weight: 600;
      color: var(--gray-800);
      width: 100px;
    }

    .schedule td {
      border: 1px solid var(--gray-200);
      vertical-align: top;
      padding: 0.8rem;
      height: 140px;
    }

    .drop-zone {
      min-height: 110px;
      border: 2px dashed transparent;
      border-radius: 8px;
      padding: 0.5rem;
      transition: all 0.2s ease;
      height: 100%;
    }

    .drop-zone.drag-over {
      border-color: var(--primary);
      background: rgba(59, 130, 246, 0.08);
    }

    .appointment-block {
      background: #fff;
      border-radius: 8px;
      padding: 0.8rem;
      margin-bottom: 0.5rem;
      box-shadow: var(--shadow-sm);
      border-left: 4px solid var(--gray-400);
      cursor: move;
      transition: all 0.2s ease;
    }

    .appointment-block:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    /* ========== TABELA DE SERVIÇOS DESKTOP ========== */
    .services-table-container {
      background: #fff;
      border: 1px solid var(--gray-200);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
      margin: 22px 0 30px;
      display: none; /* Oculto por padrão (mobile first) */
    }

    .services-table-container h3 {
      margin: 0 0 6px;
      font-size: 20px;
    }

    .services-summary {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding: 10px 0;
    }

    .export-btn {
      background: var(--success);
      color: #fff;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }

    .services-table {
      width: 100%;
      border-collapse: collapse;
    }

    .services-table th, .services-table td {
      border-bottom: 1px solid var(--gray-200);
      padding: 10px 8px;
      font-size: 14px;
    }

    .services-table thead th {
      background: var(--gray-100);
      font-weight: 600;
    }

    /* ========== BOTTOM NAVIGATION BAR ========== */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      display: flex;
      justify-content: space-around;
      padding: 0.7rem;
      border-top: 1px solid var(--gray-200);
      z-index: 100;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.3rem;
      font-size: 0.8rem;
      color: var(--gray-700);
      cursor: pointer;
    }

    .nav-item.active {
      color: var(--primary);
    }

    .nav-icon {
      font-size: 1.2rem;
    }

    /* ========== MODAIS ========== */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }

    .modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: #fff;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.2rem;
      border-bottom: 1px solid var(--gray-200);
    }

    .modal-header h3 {
      margin: 0;
      font-size: 1.2rem;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--gray-500);
    }

    .appointment-form {
      padding: 1.2rem;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      margin-bottom: 1rem;
    }

    .form-group label {
      font-weight: 500;
      margin-bottom: 0.5rem;
    }

    .form-group input, 
    .form-group select, 
    .form-group textarea {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid var(--gray-300);
      border-radius: 8px;
      font-size: 1rem;
    }

    .form-actions {
      display: flex;
      gap: 0.8rem;
      justify-content: flex-end;
      margin-top: 1.5rem;
    }

    .btn {
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
    }

    .btn.primary {
      background: var(--primary);
      color: #fff;
    }

    .btn.secondary {
      background: var(--gray-500);
      color: #fff;
    }

    .btn.danger {
      background: var(--danger);
      color: #fff;
    }

    /* ========== MEDIA QUERIES PARA TABLET/DESKTOP ========== */
    @media (min-width: 768px) {
      body {
        padding: 1rem;
        padding-bottom: 0;
      }
      
      .page {
        max-width: 1200px;
        padding: 0;
      }
      
      .page-header {
        border-radius: var(--radius);
        margin-bottom: 1rem;
        position: static;
        padding: 1.5rem 2rem;
      }
      
      .page-header h1 {
        font-size: 1.8rem;
      }
      
      .nav-bar {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        border-radius: var(--radius);
        margin-bottom: 1rem;
        padding: 1rem 1.5rem;
      }
      
      .mobile-view {
        display: none;
      }
      
      .schedule-container {
        display: block;
      }
      
      .services-table-container {
        display: block;
      }
      
      .unscheduled-container {
        border-radius: var(--radius);
      }
      
      .bottom-nav {
        display: none;
      }
      
      .form-row {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* ========== IMPRESSÃO ========== */
    .print-unscheduled-section, .print-tomorrow-section { 
      display: none; 
    }
    
    @media print {
      .print-unscheduled-section, .print-tomorrow-section { 
        display: block; 
      }
      
      .no-print { 
        display: none !important; 
      }
      
      .bottom-nav {
        display: none;
      }
      
      .mobile-view {
        display: none;
      }
      
      .schedule-container {
        display: block;
      }
    }

    /* ========== UTILITIES ========== */
    .hidden {
      display: none !important;
    }

    .text-sm {
      font-size: 0.9rem;
    }

    .text-xs {
      font-size: 0.8rem;
    }

    .mb-1 {
      margin-bottom: 0.5rem;
    }

    .mb-2 {
      margin-bottom: 1rem;
    }

    .mt-1 {
      margin-top: 0.5rem;
    }

    .mt-2 {
      margin-top: 1rem;
    }

    /* Estado vazio */
    .unscheduled-list .drop-zone.empty {
      min-height: 100px;
      border: 2px dashed var(--gray-300);
      border-radius: 12px;
      background: var(--gray-100);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--gray-500);
      text-align: center;
      padding: 1.5rem;
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- Header Mobile Optimizado -->
    <header class="page-header">
      <h1>AGENDAMENTOS FAMALICÃO</h1>
      <span class="subtitle">Agendamento serviços Expressglass</span>
      <div class="header-actions">
        <div id="connectionStatus" class="connection-status">
          <span>🌐</span>
          <span>Online</span>
        </div>
        <button id="backupBtn" class="header-btn" title="Backup de dados">
          <i class="fas fa-database"></i>
        </button>
        <button id="statsBtn" class="header-btn" title="Estatísticas">
          <i class="fas fa-chart-bar"></i>
        </button>
        <button id="searchBtn" class="header-btn" title="Pesquisar">
          <i class="fas fa-search"></i>
        </button>
      </div>
    </header>

    <!-- Barra de pesquisa -->
    <div id="searchBar" class="search-bar hidden">
      <input type="text" id="searchInput" placeholder="Pesquisar por matrícula, carro ou localidade..." />
      <button id="clearSearch" class="search-clear" type="button">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Navegação de semana para Mobile -->
    <div class="nav-bar">
      <div class="nav-group">
        <button id="prevWeek" class="nav-button" type="button">
          <i class="fas fa-chevron-left"></i>
          <span>Anterior</span>
        </button>
        <button id="todayWeek" class="nav-button" type="button">
          <i class="fas fa-calendar-day"></i>
          <span>Hoje</span>
        </button>
        <button id="nextWeek" class="nav-button" type="button">
          <span>Próxima</span>
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
      <div class="week-range" id="weekRange">—</div>
      <div class="nav-right">
        <button id="printPage" class="nav-button" type="button">
          <i class="fas fa-print"></i>
          <span>Imprimir</span>
        </button>
      </div>
    </div>

    <!-- Calendário (visível apenas em desktop) -->
    <div class="schedule-container print-page-1">
      <table id="schedule" class="schedule"></table>
    </div>

    <!-- Vista Mobile ( substitui o calendário em mobile ) -->
    <section class="mobile-view">
      <div class="mobile-day-container">
        <div class="mobile-day-header">
          <div id="mobileDayLabel" class="mobile-day-label">—</div>
          <div class="mobile-day-buttons">
            <button id="prevDay" class="nav-button small">
              <i class="fas fa-chevron-left"></i>
            </button>
            <button id="nextDay" class="nav-button small">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>
        
        <div id="mobileDayList" class="mobile-day-list">
          <!-- Os agendamentos do dia serão inseridos aqui via JavaScript -->
        </div>
        
        <button id="addServiceMobile" class="mobile-add-btn" type="button">
          <i class="fas fa-plus"></i>
          <span>Novo Serviço</span>
        </button>
      </div>
    </section>

    <!-- SERVIÇOS POR AGENDAR - Mobile -->
    <section class="unscheduled-container">
      <h3><i class="fas fa-list"></i> SERVIÇOS POR AGENDAR</h3>
      <div class="unscheduled-actions">
        <button id="addServiceBtn" class="action-btn primary" type="button">
          <i class="fas fa-plus"></i>
          <span>Novo Serviço</span>
        </button>

        <select id="filterStatus" class="filter-select">
          <option value="">Todos os estados</option>
          <option value="NE">N/E - Não Executado</option>
          <option value="VE">V/E - Vidro Encomendado</option>
          <option value="ST">ST - Serviço Terminado</option>
        </select>
      </div>
      <div id="unscheduledList" class="unscheduled-list" data-drop-bucket="unscheduled">
        <!-- Os serviços por agendar serão inseridos aqui via JavaScript -->
      </div>
    </section>

    <!-- Tabela de serviços (visível apenas em desktop) -->
    <section class="services-table-container print-page-2">
      <h3 id="servicesTableTitle">SERVIÇOS A REALIZAR</h3>
      <div class="services-summary">
        <span id="servicesSummary">Todos os serviços desde hoje em diante</span>
        <button id="exportServices" class="export-btn" type="button">📄 Exportar</button>
      </div>
      <div class="table-wrapper">
        <table id="servicesTable" class="services-table">
          <thead>
            <tr>
              <th>Data</th>
              <th>Período</th>
              <th>Matrícula</th>
              <th>Carro</th>
              <th>Serviço</th>
              <th>Observações</th>
              <th>Estado</th>
              <th>Dias</th>
              <th class="no-print">Ações</th>
            </tr>
          </thead>
          <tbody id="servicesTableBody"></tbody>
        </table>
      </div>
    </section>

    <!-- Modal Agendamento -->
    <div id="appointmentModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalTitle">Novo Agendamento</h3>
          <button id="closeModal" class="close-btn" type="button">✕</button>
        </div>

        <form id="appointmentForm" class="appointment-form">
          <div class="form-row">
            <div class="form-group">
              <label for="appointmentDate">Data</label>
              <input type="date" id="appointmentDate" />
            </div>
            <div class="form-group">
              <label for="appointmentPeriod">Período</label>
              <select id="appointmentPeriod">
                <option value="">—</option>
                <option value="Manhã">Manhã</option>
                <option value="Tarde">Tarde</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="appointmentPlate">Matrícula *</label>
              <input type="text" id="appointmentPlate" placeholder="XX-XX-XX" maxlength="8" required />
              <small class="form-hint">Formato: XX-XX-XX</small>
            </div>
            <div class="form-group">
              <label for="appointmentCar">Modelo do Carro *</label>
              <input type="text" id="appointmentCar" placeholder="Ex: BMW X3" required />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="appointmentService">Tipo de Serviço *</label>
              <select id="appointmentService" required>
                <option value="">Selecione o tipo de serviço</option>
                <option value="PB">PB - Para-brisas</option>
                <option value="LT">LT - Lateral</option>
                <option value="OC">OC - Óculo</option>
                <option value="REP">REP - Reparação</option>
                <option value="POL">POL - Polimento</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="appointmentStatus">Status do Vidro *</label>
              <select id="appointmentStatus" required>
                <option value="NE">N/E - Não Executado</option>
                <option value="VE">V/E - Vidro Encomendado</option>
                <option value="ST">ST - Serviço Terminado</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="appointmentNotes">Observações</label>
            <textarea id="appointmentNotes" placeholder="Informações adicionais" rows="3"></textarea>
          </div>

          <div class="form-group">
            <label for="appointmentExtra">Outros dados (opcional)</label>
            <textarea id="appointmentExtra" placeholder="Informações adicionais" rows="2"></textarea>
          </div>

          <div class="form-actions">
            <button type="button" id="cancelForm" class="btn secondary">Cancelar</button>
            <button type="button" id="deleteAppointment" class="btn danger hidden">Eliminar</button>
            <button type="submit" class="btn primary">Guardar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Bottom Navigation Bar para Mobile -->
    <nav class="bottom-nav">
      <div class="nav-item active" data-view="day">
        <i class="fas fa-calendar-alt nav-icon"></i>
        <span>Agenda</span>
      </div>
      <div class="nav-item" data-view="unscheduled">
        <i class="fas fa-list nav-icon"></i>
        <span>Serviços</span>
      </div>
      <div class="nav-item" data-action="add">
        <i class="fas fa-plus-circle nav-icon"></i>
        <span>Novo</span>
      </div>
      <div class="nav-item" data-action="print">
        <i class="fas fa-print nav-icon"></i>
        <span>Imprimir</span>
      </div>
      <div class="nav-item" data-action="search">
        <i class="fas fa-search nav-icon"></i>
        <span>Pesquisar</span>
      </div>
    </nav>
  </div>

  <!-- Script para melhorar a experiência mobile -->
  <script>
    // Script para melhorar a experiência mobile
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Portal Expressglass mobile otimizado!');
      
      // Alternar entre vistas
      const navItems = document.querySelectorAll('.nav-item');
      const mobileView = document.querySelector('.mobile-view');
      const unscheduledContainer = document.querySelector('.unscheduled-container');
      
      navItems.forEach(item => {
        item.addEventListener('click', function() {
          const view = this.getAttribute('data-view');
          const action = this.getAttribute('data-action');
          
          navItems.forEach(i => i.classList.remove('active'));
          this.classList.add('active');
          
          if (view === 'day') {
            mobileView.style.display = 'block';
            unscheduledContainer.style.display = 'block';
          } else if (view === 'unscheduled') {
            mobileView.style.display = 'none';
            unscheduledContainer.style.display = 'block';
            // Scroll para a seção de serviços por agendar
            unscheduledContainer.scrollIntoView({ behavior: 'smooth' });
          }
          
          if (action === 'add') {
            openAppointmentModal();
          } else if (action === 'print') {
            window.print();
          } else if (action === 'search') {
            const searchBar = document.getElementById('searchBar');
            searchBar.classList.toggle('hidden');
            if (!searchBar.classList.contains('hidden')) {
              document.getElementById('searchInput').focus();
            }
          }
        });
      });
      
      // Botões de ação
      const addButtons = document.querySelectorAll('#addServiceBtn, #addServiceMobile');
      addButtons.forEach(button => {
        button.addEventListener('click', function() {
          openAppointmentModal();
        });
      });
      
      // Simular funcionalidade de arrastar (apenas visual)
      const appointments = document.querySelectorAll('.mobile-appointment, .appointment.unscheduled');
      appointments.forEach(appointment => {
        appointment.addEventListener('touchstart', function() {
          this.style.opacity = '0.9';
        });
        
        appointment.addEventListener('touchend', function() {
          this.style.opacity = '1';
        });
      });
      
      // Botões de edição
      const editButtons = document.querySelectorAll('.icon-btn.edit');
      editButtons.forEach(button => {
        button.addEventListener('click', function() {
          const appointment = this.closest('.mobile-appointment, .appointment.unscheduled');
          const title = appointment.querySelector('.mobile-appt-header, .appt-header').textContent;
          alert(`Editando: ${title}`);
        });
      });
      
      // Botões de exclusão
      const deleteButtons = document.querySelectorAll('.icon-btn.delete');
      deleteButtons.forEach(button => {
        button.addEventListener('click', function() {
          const appointment = this.closest('.mobile-appointment, .appointment.unscheduled');
          const title = appointment.querySelector('.mobile-appt-header, .appt-header').textContent;
          if (confirm(`Tem certeza que deseja excluir: ${title}?`)) {
            appointment.style.opacity = '0';
            setTimeout(() => {
              appointment.remove();
            }, 300);
          }
        });
      });
      
      // Alternar entre mobile e desktop
      function checkViewport() {
        if (window.innerWidth >= 768) {
          // Desktop
          document.querySelector('.schedule-container').style.display = 'block';
          document.querySelector('.services-table-container').style.display = 'block';
          document.querySelector('.mobile-view').style.display = 'none';
          document.querySelector('.unscheduled-container').style.display = 'block';
        } else {
          // Mobile
          document.querySelector('.schedule-container').style.display = 'none';
          document.querySelector('.services-table-container').style.display = 'none';
          document.querySelector('.mobile-view').style.display = 'block';
          document.querySelector('.unscheduled-container').style.display = 'block';
        }
      }
      
      // Verificar viewport ao carregar e redimensionar
      checkViewport();
      window.addEventListener('resize', checkViewport);
    });
    
    // Funções globais para compatibilidade
    function openAppointmentModal(id = null) {
      document.getElementById('appointmentModal').classList.add('show');
    }
    
    function closeAppointmentModal() {
      document.getElementById('appointmentModal').classList.remove('show');
    }
    
    function closeBackupModal() {
      // Implementar se necessário
    }
    
    function closeStatsModal() {
      // Implementar se necessário
    }
  </script>

  <!-- Seu script original (importante manter) -->
  <script src="script.js?v=5" defer></script>
</body>
</html>