<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
  <title>Agendamentos Famalicão</title>
  <link rel="stylesheet" href="style.css"/>
  <meta name="theme-color" content="#2563eb">
  <style>
    /* Garantir que secções de impressão não aparecem no ecrã */
    @media screen {
      .print-unscheduled-section,
      .print-tomorrow-section { display:none; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="page-header">
      <h1>Agendamentos Famalicão</h1>
      <p class="subtitle">Agendamento serviços Expressglass</p>
      <div class="header-actions">
        <div id="connectionStatus" class="connection-status" title="Status da conexão">
          <span id="statusIcon">🌐</span>
          <span id="statusText">Online</span>
        </div>
        <button id="backupBtn" class="header-btn" title="Backup de dados">💾</button>
        <button id="statsBtn" class="header-btn" title="Estatísticas">📊</button>
        <button id="searchBtn" class="header-btn" title="Pesquisar">🔍</button>
      </div>
    </header>

    <!-- Barra de pesquisa -->
    <div id="searchBar" class="search-bar hidden">
      <input type="text" id="searchInput" placeholder="Pesquisar por matrícula, carro ou localidade..." />
      <button id="clearSearch" class="search-clear">✕</button>
    </div>

    <!-- Navegação da semana -->
    <div class="nav-bar">
      <div class="nav-left">
        <button id="prevWeek" class="nav-button">&lt; Anterior</button>
        <button id="nextWeek" class="nav-button">Próxima &gt;</button>
        <button id="todayWeek" class="nav-button">📅 Hoje</button>
      </div>
      <div class="week-range" id="weekRange">—</div>
      <div class="nav-right">
        <button id="printPage" class="nav-button">🖨 Imprimir</button>
      </div>
    </div>

    <!-- Calendário -->
    <div class="schedule-container print-page-1">
      <table id="schedule" class="schedule"></table>
    </div>

    <!-- ====== SERVIÇOS POR AGENDAR (ag2) — BLOCO AUTO-CONTIDO ====== -->
    <section id="servicos-por-agendar" class="ag2-sec">
      <div class="ag2-header">
        <h2 class="ag2-title">SERVIÇOS POR AGENDAR</h2>
        <div class="ag2-actions">
          <button id="ag2BtnNovo" class="ag2-btn ag2-btn-primary">+ Novo Serviço</button>
          <div class="ag2-select-wrap">
            <select id="ag2Filtro" class="ag2-select">
              <option value="todos">Todos os estados</option>
              <option value="NE">N/E</option>
              <option value="VE">V/E</option>
              <option value="ST">ST</option>
            </select>
            <span class="ag2-caret">▾</span>
          </div>
        </div>
      </div>
      <div id="ag2Grid" class="ag2-grid"><!-- JS injeta cartões --></div>
    </section>

    <style>
    /* ====== BLOCO ISOLADO ag2- (não afeta o resto) ====== */
    .ag2-sec{margin:16px 0;padding:14px;border-radius:16px;border:1px solid rgba(0,0,0,.06);box-shadow:0 6px 16px rgba(0,0,0,.06);background:#fff}
    .ag2-header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
    .ag2-title{margin:0;font-size:18px;font-weight:800;color:#1e293b}
    .ag2-actions{display:flex;align-items:center;gap:10px}
    .ag2-btn{display:inline-flex;align-items:center;gap:6px;padding:10px 14px;border-radius:8px;border:1px solid transparent;font-weight:600;cursor:po
